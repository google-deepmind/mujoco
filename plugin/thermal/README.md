# Sensor plugins

## Thermal

The `mujoco.sensor.thermal` plugin implements a thermal model for actuators that simulates temperature dynamics based on electrical resistance heating and heat dissipation. This sensor tracks the temperature evolution of actuators considering Joule heating from motor current and heat transfer to the environment.

### Physical Model

The plugin implements a lumped-parameter thermal model with the following dynamics:

#### Heat Balance Equation

$$C \cdot \frac{dT}{dt} = P_{in} - P_{out}$$

where:
- $C$ [J/K]: thermal capacitance
- $T$ [K]: temperature
- $P_{in}$ [W]: heat generated by electrical resistance
- $P_{out}$ [W]: heat dissipated to environment

#### Heat Generation

The heat generated follows Joule's law:

$$P_{in} = I^2 \cdot R(T)$$

where the motor current $I$ is computed from the actuator force:

$$I = \frac{F}{K_t(T) \cdot G}$$

- $F$ [N]: actuator force
- $G$: gear ratio
- $K_t(T)$ [Nm/A]: temperature-dependent torque constant

#### Temperature Dependencies

**Electrical Resistance:**
$$R(T) = R_{nom} \cdot (1 + \alpha \cdot (T - 298.15))$$

**Torque Constant:**
$$K_t(T) = K_{t25} + \frac{K_{t130} - K_{t25}}{403.15 - 298.15} \cdot (T - 298.15)$$

where temperatures are in Kelvin, and the reference temperatures are 25°C (298.15K) and 130°C (403.15K).

#### Heat Dissipation

Heat dissipation to the environment follows Newton's law of cooling:

$$P_{out} = \frac{T - T_{ambient}}{R_{th}}$$

where $R_{th}$ [K/W] is the thermal resistance.

### Parameters

| Attribute | Unit | Default | Description |
|-----------|------|---------|-------------|
| `C` | J/K | Required | Thermal capacitance of the actuator |
| `Rth` | K/W | Required | Thermal resistance to ambient |
| `RNorm` | Ω | Required | Electrical resistance at 25°C |
| `TempCoeff` | 1/K | Required | Temperature coefficient of resistance (α) |
| `Kt25` | Nm/A | Required | Torque constant at 25°C |
| `Kt130` | Nm/A | Required | Torque constant at 130°C |
| `G` | - | Required | Gear ratio |

### Usage

```xml
<mujoco>
  <extension>
    <plugin plugin="mujoco.sensor.thermal">
      <instance name="motor_thermal">
        <config key="C" value="42"/>
        <config key="Rth" value="3.4"/>
        <config key="RNorm" value="0.46"/>
        <config key="TempCoeff" value="0.039"/>
        <config key="Kt25" value="0.068"/>
        <config key="Kt130" value="0.061"/>
        <config key="G" value="3141.59"/>
      </instance>
    </plugin>
  </extension>

  <custom>
    <numeric name="ambient_temperature" data="298.15"/>
  </custom>

  <worldbody>
    <body name="moving_body" pos="0 0 0.1">
      <joint name="linear" type="slide" axis="1 0 0"/>
      <geom type="cylinder" size="0.1 0.5" mass="0.1"/>
    </body>
  </worldbody>

  <actuator>
    <motor name="motor" joint="linear"/>
  </actuator>

  <sensor>
    <plugin name="motor_temperature" instance="motor_thermal" 
            objtype="actuator" objname="motor"/>
  </sensor>
</mujoco>
```

### Notes

- The ambient temperature must be defined as a custom numeric value named `ambient_temperature` in Kelvin.
- The sensor output is the current temperature of the actuator in Kelvin.
- Each sensor instance tracks the temperature state of one actuator.
- Temperature is initialized to ambient temperature when the simulation resets.
- The plugin uses Euler integration with the simulation timestep for temperature updates.

### Example Model

See [thermal_test.xml](../../test/plugin/thermal/testdata/thermal_test.xml) for a complete example demonstrating the thermal plugin with a sliding mass actuated by a motor.